<form class="form-horizontal" name="facilityForm" data-ng-submit="preview()" role="form" novalidate>
  <!-- ======================================================
    -- [START] Facility section
    -- ====================================================== !-->
  <div class="panel panel-default">    
    <div class="panel-body">
      <p>
        <span class="label label-default">Research Facility Information</span>
      </p>
      
      <div class="row">
        <div class="col-lg-6">
          <div data-af-field data-af-field-label="Facility*">
            <input class="form-control" name="facilityName" data-ng-model="form.data.facility.name" required>
          </div>
          
          <div data-af-field data-af-field-label="Organization*">
            <select class="form-control" id="facility-organization" name="facilityOrganization" data-ng-model="form.data.facility.organizationId" data-ng-options="i.id as i.name for i in form.organizations" required>
            </select>
          </div>
          
          <div data-af-field data-af-field-label="Organization name*" data-ng-if="form.data.facility.organizationId == -1">
            <input type="text" class="form-control" name="facilityOrganizationName" data-ng-model="form.data.organization.name" required>
          </div>
        </div><!-- End of .col-x-x -->

        <div class="col-lg-6">
          <div data-af-field data-af-field-label="City*">
            <input type="text" class="form-control" name="facilityCity" data-ng-model="form.data.facility.city" required>
          </div>
          
          <div data-af-field data-af-field-label="Province*">          
            <select class="form-control" name="facilityProvince" id="facility-province" data-ng-model="form.data.facility.provinceId" data-ng-options="p.id as p.name for p in form.provinces" required>
            </select>
          </div>
          
          <div data-af-field data-af-field-label="Facility website">
            <input type="url" class="form-control" name="facilityWebsite" data-ng-model="form.data.facility.website" data-ng-model-options="{ debounce: 500 }" placeholder="http://example.com">
          </div>
        </div><!-- End of .col-x-x -->
      </div><!-- End of .row -->
      
      <div data-af-field data-af-field-label="What the facility does*" data-af-field-textangular="true">
        <div data-text-angular data-ng-model="form.data.facility.description" name="facilityDescription" required></div>
      </div>
      
      <hr>
      
      <div data-ng-form name="disciplinesForm">
        <!--
          -- This part is a bit of a hack. The directive 'af-field' is not able to retrieve all the details (name, id, etc)
          -- from the input element (probably because of ng-repeat) by itself. So we're using the 'af-field-name' option
          -- to override the default behaviour of the directive and just provide it with the name manually. Each checkbox
          -- has a unique name so we're not able to provide the directive with the names of all the checkboxes so we're
          -- only giving it the name of the first checkbox. Technically the directive should be repeated for each checkbox
          -- but then we'll end up losing the layout and each checkbox will end up up with its own label. Since we're only
          -- providing the name of the first checkbox, validation is a problem.  Please have a look at the
          -- '$scope.form.validateDisciplines()' function for how this was dealt with.
          -->
        <div data-af-field data-af-field-label="Disciplines*" data-af-field-name="facilityDisciplinesC10" data-af-field-type="checkbox">
          <div class="row">
            <div class="col-md-6">
              <div data-ng-repeat="d in form.disciplines | limitTo: 5">
                <div class="checkbox">
                  <label>
                    <input type="checkbox" name="facilityDisciplinesC1{{$index}}" data-ng-model="d.isSelected" data-ng-change="form.validateDisciplines(disciplinesForm)" data-ng-required="form.disciplines[0].isRequired"> {{d.name}}
                  </label>
                </div>
              </div>
            </div>
            
            <div class="col-md-6">
              <div data-ng-repeat="d in form.disciplines | limitTo: 4:5">
                <div class="checkbox">
                  <label>
                    <input type="checkbox" name="facilityDisciplinesC2{{$index}}" data-ng-model="d.isSelected" data-ng-change="form.validateDisciplines(disciplinesForm)" data-ng-required="form.disciplines[0].isRequired"> {{d.name}}
                  </label>
                </div>
              </div>
            </div>    
          </div><!-- End of .row -->
        </div>
      </div><!-- End of ng-form -->
          
      <div class="row">
        <div class="col-md-6">      

        </div><!-- End of .col-*-* -->
      </div>
  
      <hr>
    
      <div data-ng-form name="sectorsForm">
        <!--
          -- Please have a look at the comments for 'disciplinesForm' above for how we're using the 'af-field' directive.
          -- Exact same scenario here.
          -->
        <div data-af-field data-af-field-label="Sectors*" data-af-field-name="facilitySectorsC10" data-af-field-type="checkbox">
          <div class="row">
            <div class="col-md-6">
              <div data-ng-repeat="s in form.sectors | limitTo: 15">
                <div class="checkbox">
                  <label>
                    <input type="checkbox" name="facilitySectorsC1{{$index}}" data-ng-model="s.isSelected" data-ng-change="form.validateSectors(sectorsForm)" data-ng-required="form.sectors[0].isRequired"> {{s.name}}
                  </label>
                </div>
              </div>
            </div>
            
            <div class="col-md-6">
              <div data-ng-repeat="s in form.sectors | limitTo: 14:15">
                <div class="checkbox">
                  <label>
                    <input type="checkbox" name="facilitySectorsC2{{$index}}" data-ng-model="s.isSelected" data-ng-change="form.validateSectors(sectorsForm)" data-ng-required="form.sectors[0].isRequired"> {{s.name}}
                  </label>
                </div>
              </div> 
            </div>
          </div><!-- End of .row -->
        </div>
      </div><!-- End of .ng-form -->
    </div><!-- End of .panel-body -->
  </div><!-- End of .panel -->
  <!-- ======================================================
    -- [END] Facility section
    -- ====================================================== !-->
  
  <!-- ======================================================
    -- [START] Contact information
    -- ====================================================== !-->
  <div class="panel panel-default">    
    <div class="panel-body">
      <p>
        <span class="label label-default">Contact Information</span>
        <span data-ng-show="form.contactIndex === 0" class="label label-info">Primary point of contact</span> 
      </p>
  
      <div class="row">
        <div class="col-lg-2">
          <table class="table table-condensed table-list">
            <tbody>
              <tr data-ng-repeat="c in form.data.contacts" data-ng-class="{active: form.contactIndex === $index}" data-ng-click="form.contactIndex = $index">
                <td>
                  <a href="">
                    <span data-ng-hide="c.firstName || c.lastName">Contact #{{$index + 1}}</span>
                    <span data-ng-show="c.firstName || c.lastName">{{c.firstName}} {{c.lastName}}</span>
                  </a>
                </td>
                <td>
                  <a href="" data-ng-show="$index !== 0" data-ng-click="form.removeContact($index)">
                    <span class="text-danger">
                      <span class="glyphicon glyphicon-remove"></span>
                    </span>
                  </a>                         
                </td>
              </tr>
            </tbody>
          </table>
          
          <button type="button" class="btn btn-default btn-sm" data-ng-click="form.addContact()"><span class="glyphicon glyphicon-plus"></span> Contacts</button>
        </div><!-- End of .col-x-x -->
        
        <div class="col-lg-10">                    
          <div data-ng-repeat="c in form.data.contacts">
            <div data-ng-form name="contactForm">
              <div class="row" data-ng-show="form.contactIndex === $index">
                <div class="col-lg-6">
                  <div data-af-field data-af-field-label="First name*">
                    <input type="text" class="form-control" name="contactFirstName" data-ng-model="c.firstName" required>
                  </div>
                  
                  <div data-af-field data-af-field-label="Last name*">
                    <input type="text" class="form-control" name="contactLastName" data-ng-model="c.lastName" required>
                  </div>
                  
                  <div data-af-field data-af-field-label="Email*">
                    <input type="email" class="form-control" name="contactEmail" data-ng-model="c.email" data-ng-model-options="{ debounce: 500 }" placeholder="me@example.com" required>
                  </div>
                  
                  <div data-af-field data-af-field-label="Telephone*" data-ng-if="$index === 0">
                    <input type="text" class="form-control" name="contactTelephone" data-ng-model="c.telephone" data-ng-model-options="{ debounce: 500 }" data-ng-pattern="/^\d{10}$/" placeholder="5555555555" required>
                  </div>
                  
                  <div data-af-field data-af-field-label="Telephone" data-ng-if="$index !== 0">
                    <input type="text" class="form-control" name="contactTelephone" data-ng-model="c.telephone" data-ng-model-options="{ debounce: 500 }" data-ng-pattern="/^\d{10}$/" placeholder="5555555555">
                  </div>
                </div><!-- End of .col-x-x -->
                
                <div class="col-lg-6">
                  <div data-af-field data-af-field-label="Position*" data-ng-if="$index === 0">
                    <input type="text" class="form-control" name="contactPosition" data-ng-model="c.position" required>
                  </div>
                  
                  <div data-af-field data-af-field-label="Position" data-ng-if="$index !== 0">
                    <input type="text" class="form-control" name="contactPosition" data-ng-model="c.position">
                  </div>
                  
                  <div data-af-field data-af-field-label="Website">
                    <input type="url" class="form-control" name="contactWebsite" data-ng-model="c.website" data-ng-model-options="{ debounce: 500 }" placeholder="http://example.com">
                  </div>
                  
                  <div data-af-field data-af-field-label="Extension">
                    <input type="text" class="form-control" name="contactExtension" data-ng-model="c.extension">
                  </div>
                </div><!-- End of .col-x-x -->
              </div><!-- End of .row -->
            </div><!-- End of ng-form -->
          </div><!-- End of ng-repeat -->
        </div><!-- End of .col-x-x -->
      </div><!--End of .row -->
    </div><!-- End of .panel-body -->
  </div><!-- End of .panel -->
  <!-- ======================================================
    -- [END] Contact information
    -- ====================================================== !-->
  
  <!-- ======================================================
    -- [START] Equipment information
    -- ====================================================== !-->  
  <div class="panel panel-default">    
    <div class="panel-body">
      <p>
        <span class="label label-default">Equipment</span>
      </p>
      
      <div class="row">
        <div class="col-lg-2">
          <table class="table table-condensed table-list">
            <tbody>
              <tr data-ng-repeat="e in form.data.equipment" data-ng-class="{active: form.equipmentIndex === $index}" data-ng-click="form.equipmentIndex = $index">
                <td>
                  <a href="">
                    <span data-ng-hide="e.type">Equipment #{{$index + 1}}</span>
                    <span data-ng-show="e.type">{{e.type}} <span data-ng-show="e.manufacturer">({{e.manufacturer}})</span></span>
                  </a>
                </td>
                <td>
                  <a href="" data-ng-show="$index !== 0" data-ng-click="form.removeEquipment($index)">
                    <span class="text-danger">
                      <span class="glyphicon glyphicon-remove"></span>
                    </span>
                  </a>                         
                </td>
              </tr>
            </tbody>
          </table>
          
          <button type="button" class="btn btn-default btn-sm" data-ng-click="form.addEquipment()"><span class="glyphicon glyphicon-plus"></span> Equipment</button>
        </div><!-- End of .col-x-x -->
        
        <div class="col-lg-10">
          <div data-ng-repeat="e in form.data.equipment">
            <div data-ng-form name="equipmentForm">
              <div class="row" data-ng-show="form.equipmentIndex === $index">
                <div class="col-lg-12">
                  <div data-af-field data-af-field-label="Type*">
                    <input type="text" class="form-control" name="equipmentType" data-ng-model="e.type" placeholder="Eg. Magnetic resonance imaging (MRI)" required>
                  </div>
                  
                  <div data-af-field data-af-field-label="Manufacturer">
                    <input type="text" class="form-control" name="equipmentManufacturer" placeholder="Eg. Hitachi Medical" data-ng-model="e.manufacturer">
                  </div>

                  <div data-af-field data-af-field-label="Model">
                    <input type="text" class="form-control" name="equipmentModel" placeholder="Eg. Echelon Oval 1.5T Ultra-Wide MRI system" data-ng-model="e.model">
                  </div>
                  
                  <!--
                    -- For this part, we have to use $index to make the names unique otherwise textAngular will complain. The same
                    -- goes for equipment specifications.
                    -->
                  <div data-af-field data-af-field-label="Equipment purpose*" data-af-field-textangular="true">
                    <div data-text-angular name="equipmentPurpose{{$index}}" data-ng-model="e.purpose" required></div>
                  </div>
                  
                  <div data-af-field data-af-field-label="Equipment specifications" data-af-field-textangular="true">
                    <div data-text-angular name="equipmentSpecifications{{$index}}" data-ng-model="e.specifications"></div>
                  </div>
                  
                  <div data-af-field data-af-field-label="Year purchased">
                    <input type="text" class="form-control" name="equipmentYearPurchased" data-ng-model="e.yearPurchased" data-ng-model-options="{ debounce: 500 }" pattern="(?:19|20)[0-9]{2}" placeholder="Eg. 1995">
                  </div>
                  
                  <div data-af-field data-af-field-label="Excess capacity*">
                    <div class="radio">
                      <label>
                        <input type="radio" name="equipmentExcessCapacity{{$index}}" data-ng-model="e.hasExcessCapacity" data-ng-value="true" required> Yes 
                      </label>
                      <label>
                        <input type="radio" name="equipmentExcessCapacity{{$index}}" data-ng-model="e.hasExcessCapacity" data-ng-value="false" required> No
                      </label>
                    </div>
                  </div>
                  
                  <div data-af-field data-af-field-label="Search visibility*">
                    <div class="radio">
                      <label>
                        <input type="radio" name="equipmentIsPublic{{$index}}" data-ng-model="e.isPublic" data-ng-value="true" selected required> Public 
                      </label>
                      <label>
                        <input type="radio" name="equipmentIsPublic{{$index}}" data-ng-model="e.isPublic" data-ng-value="false" required> Hidden
                      </label>
                    </div>
                  </div>
                  
                  <div data-af-field data-af-field-label="Keywords">
                    <input type="text" class="form-control" name="equipmentKeywords" data-ng-model="e.keywords" placeholder="NMRI, MRT, etc">
                  </div>
                </div><!-- End of .col-x-x -->
              </div><!-- End of .row -->
            </div><!-- End of ng-form -->
          </div><!-- End of ng-repeat -->
        </div><!-- End of col-x-x -->
      </div><!-- End of .row -->
    </div><!-- End of .panel-body -->
  </div><!-- End of .panel -->
  <!-- ======================================================
    -- [END] Equipment information
    -- ====================================================== !-->
  
  <div>
    <button type="submit" class="btn btn-default" data-ng-disabled="facilityForm.$invalid" data-ng-click="preview()">Preview</button>
    <button type="button" class="btn btn-default" data-ng-show="_state.is('facilities.form.create')" data-ng-click="form.clearSave(); _state.reload();">Reset form</button>
    <p>
      <p class="text-warning" data-ng-show="facilityForm.$invalid && !facilityForm.$pristine">Please complete all mandatory fields first</p>
    </p>
  </div>
</form>
