<div class="af-search-page-results" 
     data-dir-paginate="f in search.results | itemsPerPage: search.resource.hitsPerPage" 
     data-total-items="search.resource.nbHits" 
     data-pagination-id="facilityResults" 
     data-current-page="search.query.page">
  <a data-ui-sref="facilities.show({ facilityId: f.id })">
    <div class="panel panel-default">
      <div class="panel-body">
        <p class="h4">
          <span data-ng-bind-html="f._highlightResult.name.value || f.name"></span>
          <span data-ng-show="f.organization.name">
            | <span data-ng-bind-html="f._highlightResult.organization.name.value || f.organization.name"></span>
          </span>
        </p>
        
        <p class="small text-muted">
            <span data-ng-show="f.city">
              <span data-ng-bind-html="f._highlightResult.city.value || f.city"></span>,
            </span>
            <span data-ng-bind-html="f._highlightResult.province.name.value || f.province.name"></span>
        </p>

        <p data-ng-if="f._highlightResult.primaryContact
                       && (f._highlightResult.primaryContact.firstName.matchLevel != 'none' 
                       || f._highlightResult.primaryContact.lastName.matchLevel != 'none' 
                       || f._highlightResult.primaryContact.position.matchLevel != 'none')">
          <span class="label label-default">Primary Contact</span>
          <span data-ng-bind-html="f._highlightResult.primaryContact.firstName.value"></span>
          <span data-ng-bind-html="f._highlightResult.primaryContact.lastName.value"></span>
          (<span data-ng-bind-html="f._highlightResult.primaryContact.position.value"></span>)
        </p>

        <div data-ng-repeat="c in f._highlightResult.contacts">
          <p data-ng-if="c.firstName.matchLevel != 'none' 
                         || c.lastName.matchLevel != 'none' 
                         || c.position.matchLevel != 'none'">
            <span class="label label-default">Contact #{{ $index + 1 }}</span>
            <span data-ng-bind-html="c.firstName.value"></span>
            <span data-ng-bind-html="c.lastName.value"></span>
            <span data-ng-if="c.position.value">
              (<span data-ng-bind-html="c.position.value"></span>)
            </span>
          </p>
        </div>

        <p data-ng-if="f._highlightResult.organization.ilo
                       && (f._highlightResult.organization.ilo.firstName.matchLevel != 'none' 
                       || f._highlightResult.organization.ilo.lastName.matchLevel != 'none' 
                       || f._highlightResult.organization.ilo.position.matchLevel != 'none')">
          <span class="label label-default">ILO</span>
          <span data-ng-bind-html="f._highlightResult.organization.ilo.firstName.value"></span>
          <span data-ng-bind-html="f._highlightResult.organization.ilo.lastName.value"></span>
          (<span data-ng-bind-html="f._highlightResult.organization.ilo.position.value"></span>)
        </p>

        <p data-ng-if="f.description">
          <span data-ng-bind-html="f._snippetResult.description.value || f.descriptionNoHtml 
                                   | afEllipses:(f._snippetResult.description.value ? null : 170)">
          </span>
        </p>
      </div>
    </div>
  </a>
</div><!-- End of dir-paginate -->

<div data-dir-pagination-controls 
     data-pagination-id="facilityResults" 
     data-on-page-change="_state.is('search.q') ? 
                          search.index(false, search.query.page, true) : search.index(true, search.query.page, true)" 
     data-ng-disabled="true" 
     data-max-size="_getWidth() < 400 ? 5 : 9">
</div>
