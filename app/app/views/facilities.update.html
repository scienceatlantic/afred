<p data-af-page-title="Keep your Facility Up-to-date"></p>

<div>
  <h1>Keep your Facility Up-to-date</h1>
  
  <p>
    If you are listed as a contact for a facility, you will be able to update it. Please follow the instructions listed
    below:
  </p>
  
  <p>
    <ul>
      <li>
        Input the email address used when your facility was submitted into the form below. A list of facilities attached
        to that email address will then be displayed.
      </li>
      <li>
        Click the <kbd>Request update</kbd> button corresponding to the facility you wish to update, and confirm the
        request. You will receive an email containing a unique link that will allow you to update your facility. If the
        <kbd>Request update</kbd> button is not available, you should instead see the following statuses listed:
        <ul>
          <li>
            <b>OPEN</b> - An update request for this facility has already been made. You are not allowed to generate
            more than one update request at a time.
          </li>
          <li>
            <b>PENDING</b> - An edit of this facility has already been submitted for review. Please be patient while
            an AFRED administrator reviews the edit. You are not allowed to generate another update request
            until the edit has been reviewed.
          </li>
        </ul>
      </li>
    </ul>
  </p>
    
  <p>
    If you are having trouble with this form, or have any questions about updating your facility, please contact
    <a href="mailto:afred@scienceatlantic.ca">afred@scienceatlantic.ca</a>.
  </p>
  
  <br>
  <form class="form-inline" data-ng-submit="reset(); submit();" novalidate>
    <div class="form-group">
      <div class="input-group">
        <div class="input-group-addon">Email</div>
        <input type="text" class="form-control" id="Email" 
               data-ng-model="form.data.email" data-ng-change="reset()" placeholder="me@example.com">
      </div>
    </div>
    
    <button type="submit" class="btn btn-default"
            data-af-loading-btn="fr.$resolved === false && pagination.page === 1"
            data-ng-disabled="fr.$resolved === false"
            data-af-loading-btn-text="Searching...">
      Search <span class="fa fa-search"></span>
    </button>
  </form>
  
  <div data-ng-show="view.show === 'NO_RESULTS_MESSAGE'">
    <hr>
    <p>No matching facilities found with the email address provided.</p>
  </div>
  
  <br>
  <div data-ng-show="view.show === 'RESULTS'">
    <div class="panel panel-default">
      <div class="panel-body">
        <div data-ng-repeat="facility in facilities">
          <p>
            <a data-ui-sref="facilities.show({ facilityId: facility.id })" target="_blank">
              {{ facility.name }}
            </a>
            <span data-ng-if="facility.city">| {{ facility.city }}</span>
          </p>
          
          <p data-ng-show="facility.status === 'OPEN' || facility.status === 'PENDING'">
            <span class="label label-default">{{ facility.status }}</span>
            <span class="label label-default">{{ facility.editorFirstName }} {{ facility.editorLastName }}</span>           
          </p>
          
          <p data-ng-hide="facility.status === 'OPEN' || facility.status === 'PENDING'">
            <button class="btn btn-default btn-xs"
                    data-ng-click="form.buttons.selectedIndex = $index; requestToken($index, facility.id)"
                    data-af-loading-btn="ful.$resolved === false && form.buttons.selectedIndex === $index"
                    data-af-loading-btn-text="Emailing..."
                    data-ng-disabled="ful.$resolved === false">
              Request update <span class="fa fa-send"></span>
            </button>
          </p>
          <hr data-ng-hide="$index === facilities.length - 1">
        </div>
      </div>
    </div>
    
    <p>
      <button type="button" class="btn btn-default btn-sm"
              data-ng-click="pagination.page = pagination.page + 1; submit()"
              data-af-loading-btn="fr.$resolved === false"
              data-ng-disabled="fr.$resolved === false || fr.currentPage === fr.lastPage">
        Load more <span class="fa fa-plus"></span>
      </button>
    </p>
  </div>
</div>
